<%- include('../layouts/header') %>

<div class="container-fluid py-4">
	<h1 class="mt-2">Car Management Dashboard</h1>
	<a class="btn btn-primary" href="/admin/cars/create" role="button">Add New Car </a>
	<div class="row mt-4">
		<% cars.forEach(function(car) { %>
		<div class="col-lg-3 mb-lg-0 mb-4">
			<div class="card z-index-2">
				<div class="card-body p-3">
					<img src="/assets/uploads/<%= car.image %>" class="card-img-top" alt="<%= car.nama %>" />
					<h3 class="ms-2 mt-4 mb-0 card-title"><%= car.nama %></h3>
					<p class="card-text">Rp<%= car.harga %> / Hari</p>
					<p class="card-text">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							viewBox="0 0 20 20"
							fill="currentColor"
							class="bi bi-clock"
							width="16"
							height="16"
						>
							<path
								d="M9.25 4a.75.75 0 0 1 .75.75v4.794l3.02 1.809a.75.75 0 1 1-.75 1.298l-3.77-2.262a.75.75 0 0 1-.25-.56V4.75a.75.75 0 0 1 .75-.75z"
							/>
							<path fill-rule="evenodd" d="M10 1a9 9 0 1 1 0 18 9 9 0 0 1 0-18zm0 1a8 8 0 1 1 0 16 8 8 0 0 1 0-16z" />
						</svg>
						Updated At <%= car.updated_at.toDateString() %>
					</p>
					<a href="/admin/cars/edit/<%= car.id %>" class="btn btn-warning btn-sm">Edit</a>
					<form
						action="/admin/cars/<%= car.id %>?_method=DELETE"
						method="POST"
						id="deleteForm_<%= car.id %>"
						class="d-inline-block"
					>
						<input type="hidden" name="_method" value="DELETE" />
						<input type="hidden" name="id" value="<%= car.id %>" />
						<button
							type="button"
							class="btn btn-danger btn-sm delete-car"
							data-id="<%= car.id %>"
							data-name="<%= car.name %>"
						>
							Delete
						</button>
					</form>
				</div>
			</div>
		</div>
		<% }); %>
	</div>
	<div class="row my-4">
		<div class="col-lg-10 col-md-6 mb-md-0 mb-4">
			<div class="card">
				<div class="card-header pb-0">
					<div class="row">
						<div class="col-lg-6 col-7">
							<h6>Projects</h6>
						</div>
						<div class="col-lg-6 col-5 my-auto text-end">
							<div class="dropdown float-lg-end pe-4">
								<a class="cursor-pointer" id="dropdownTable" data-bs-toggle="dropdown" aria-expanded="false">
									<i class="fa fa-ellipsis-v text-secondary"></i>
								</a>
								<ul class="dropdown-menu px-2 py-3 ms-sm-n4 ms-n5" aria-labelledby="dropdownTable">
									<li><a class="dropdown-item border-radius-md" href="javascript:;">Action</a></li>
									<li><a class="dropdown-item border-radius-md" href="javascript:;">Another action</a></li>
									<li><a class="dropdown-item border-radius-md" href="javascript:;">Something else here</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="card-body px-0 pb-2">
					<div class="table-responsive">
						<table class="table align-items-center mb-0">
							<thead>
								<tr>
									<th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Nama Mobil</th>
									<th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Foto</th>
									<th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
										Budget
									</th>
									<th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
										Handle Action
									</th>
								</tr>
							</thead>
							<tbody>
								<% if (cars.length > 0) { %> <% cars.forEach(car => { %>
								<tr>
									<td>
										<div class="d-flex px-2 py-1">
											<div class="d-flex flex-column justify-content-center">
												<h6 class="mb-0 text-sm"><%= car.nama %></h6>
											</div>
										</div>
									</td>
									<td>
										<div class="avatar-group mt-2 h-10 w-10">
											<img src="/assets/uploads/<%= car.image %>" alt="<%= car.nama %>" height="50px" />
										</div>
									</td>
									<td class="align-middle text-center text-sm">
										<span class="text-xs font-weight-bold"> <%= car.harga %> </span>
									</td>
									<td>
										<a href="/admin/cars/edit/<%= car.id %>" class="btn btn-warning btn-sm">Edit</a>
										<form
											action="/admin/cars/<%= car.id %>?_method=DELETE"
											method="DELETE"
											id="deleteForm_<%= car.id %>"
											class="d-inline-block"
										>
											<input type="hidden" name="_method" value="DELETE" />
											<input type="hidden" name="id" value="<%= car.id %>" />
											<button
												type="button"
												class="btn btn-danger btn-sm delete-car"
												data-id="<%= car.id %>"
												data-name="<%= car.name %>"
											>
												Delete
											</button>
										</form>
									</td>
								</tr>
								<% }) %> <% } else { %>
								<tr>
									<td>-</td>
									<td>-</td>
									<td>-</td>
									<td>-</td>
								</tr>
								<% } %>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<!-- SweetAlert 2 JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script>
	$(document).ready(function () {
		$(".delete-car").on("click", function () {
			var id = $(this).data("id");
			var name = $(this).data("name");
			var formId = "deleteForm_" + id;
			Swal.fire({
				title: "Hapus Mobil?",
				text: "Apakah anda yakin ingin mengapus " + name + "?",
				icon: "warning",
				showCancelButton: true,
				confirmButtonColor: "#d33",
				cancelButtonColor: "#3085d6",
				confirmButtonText: "Hapus!",
			}).then((result) => {
				if (result.isConfirmed) {
					$("#" + formId).submit();
				}
			});
		});
	});
</script>
<%- include('../layouts/footer') %>
